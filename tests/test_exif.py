import unittest
from img_renamer import convert_exif_date_to_date_parts, get_exif_date


class TestExifDate(unittest.TestCase):
    def test_get_proper_exif_date(self):
        exif_date = "2019:10:28 17:33:15"
        expected_match = {'YYYY': '2019', 'MM': '10', 'DD': '28', 'HH': '17', 'mm': '33', 'ss': '15'}

        match = convert_exif_date_to_date_parts(exif_date)

        self.assertEqual(match, expected_match)

    def test_get_improper_exif_date(self):
        exif_date = "TESTTEST"
        expected_match = None

        match = convert_exif_date_to_date_parts(exif_date)

        self.assertEqual(match, expected_match)


class TestExifDecoder(unittest.TestCase):
    def test_read_proper_exif(self):
        expected_date = "2019:10:28 17:33:15"
        jpg = bytes([
            0xFF, 0xD8, 0xFF, 0xE0, 0x00, 0x10, 0x4A, 0x46, 0x49, 0x46, 0x00, 0x01, 0x01, 0x01, 0x01, 0x2C,
            0x01, 0x2C, 0x00, 0x00, 0xFF, 0xE1, 0x00, 0x36, 0x45, 0x78, 0x69, 0x66, 0x00, 0x00, 0x49, 0x49,
            0x2A, 0x00, 0x08, 0x00, 0x00, 0x00, 0x01, 0x00, 0x32, 0x01, 0x02, 0x00, 0x14, 0x00, 0x00, 0x00,
            0x1A, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x32, 0x30, 0x31, 0x39, 0x3A, 0x31, 0x30, 0x3A,
            0x32, 0x38, 0x20, 0x31, 0x37, 0x3A, 0x33, 0x33, 0x3A, 0x31, 0x35, 0x00, 0xFF, 0xE2, 0x02, 0xB0,
        ])

        actual_date = get_exif_date(jpg)

        self.assertEqual(expected_date, actual_date)


if __name__ == '__main__':
    unittest.main()
